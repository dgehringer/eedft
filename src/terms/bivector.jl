function compute_ฯ_r(ฯยนยฒ, ๐ยนยฒ, ๐)
   Pแตข, Pโฑผ, Pโ = ๐
   Sแตขยนยฒ, Sโฑผยนยฒ, Sโยนยฒ = ๐ยนยฒ

   SโฑผยนยฒSโยนยฒ = Sโฑผยนยฒ *แตฃ Sโยนยฒ
   SโยนยฒSแตขยนยฒ = Sโยนยฒ *แตฃ Sแตขยนยฒ
   SแตขยนยฒSโฑผยนยฒ = Sแตขยนยฒ *แตฃ Sโฑผยนยฒ

   ฯยนยฒSแตขยนยฒ = ฯยนยฒ *แตฃ Sแตขยนยฒ
   ฯยนยฒSโฑผยนยฒ = ฯยนยฒ *แตฃ Sโฑผยนยฒ
   ฯยนยฒSโยนยฒ = ฯยนยฒ *แตฃ Sโยนยฒ

   ฯแตขโบ = (SโฑผยนยฒSโยนยฒ +แตฃ ฯยนยฒSแตขยนยฒ) *แตฃ Pแตข
   ฯแตขโป = (SโฑผยนยฒSโยนยฒ -แตฃ ฯยนยฒSแตขยนยฒ) *แตฃ Pแตข

   ฯโฑผโบ = (SโยนยฒSแตขยนยฒ +แตฃ ฯยนยฒSโฑผยนยฒ) *แตฃ Pโฑผ
   ฯโฑผโป = (SโยนยฒSแตขยนยฒ -แตฃ ฯยนยฒSโฑผยนยฒ) *แตฃ Pโฑผ

   ฯโโบ = (SแตขยนยฒSโฑผยนยฒ +แตฃ ฯยนยฒSโยนยฒ) *แตฃ Pโ
   ฯโโป = (SแตขยนยฒSโฑผยนยฒ -แตฃ ฯยนยฒSโยนยฒ) *แตฃ Pโ

   return (ฯแตขโบ, ฯแตขโป, ฯโฑผโบ, ฯโฑผโป, ฯโโบ, ฯโโป)
end

function compute_B_r(๐)
   ฯแตขโบ, ฯแตขโป, ฯโฑผโบ, ฯโฑผโป, ฯโโบ, ฯโโป = ๐

   ๐โฒ = ((ฯแตขโบ, ฯแตขโป), (ฯโฑผโบ, ฯโฑผโป), (ฯโโบ, ฯโโป))

   Dแตข, Dโฑผ, Dโ = ( inv_r(1.0 -แตฃ (ฯโป *แตฃ ฯโบ))  for (ฯโบ, ฯโป) in ๐โฒ)

   Bแตขแต = (ฯโโป -แตฃ (ฯโฑผโบ *แตฃ ฯแตขโบ)) *แตฃ Dแตข
   Bแตขสฒ = (ฯโฑผโบ -แตฃ (ฯโโป *แตฃ ฯแตขโป)) *แตฃ Dแตข

   Bโฑผโฑ = (ฯแตขโป -แตฃ (ฯโโบ *แตฃ ฯโฑผโบ)) *แตฃ Dโฑผ
   Bโฑผแต = (ฯโโบ -แตฃ (ฯแตขโป *แตฃ ฯโฑผโป)) *แตฃ Dโฑผ

   Bโสฒ = (ฯโฑผโป -แตฃ (ฯแตขโบ *แตฃ ฯโโบ)) *แตฃ Dโ
   Bโโฑ = (ฯแตขโบ -แตฃ (ฯโฑผโป *แตฃ ฯโโป)) *แตฃ Dโ

   return (Bแตขแต, Bแตขสฒ, Bโฑผโฑ, Bโฑผแต, Bโสฒ, Bโโฑ)
end


function compute_๐ฬ_r(ฯยนยฒ, ๐ยนยฒ, ๐)
   Pแตข, Pโฑผ, Pโ = ๐
   Sแตขยนยฒ, Sโฑผยนยฒ, Sโยนยฒ = ๐ยนยฒ
   โSแตขยนยฒ, โSโฑผยนยฒ, โSโยนยฒ = map(โแตฃ, ๐ยนยฒ)
   โยฒSแตขยนยฒ, โยฒSโฑผยนยฒ, โยฒSโยนยฒ = map(ฮแตฃ, ๐ยนยฒ)
   โยฒฯยนยฒ = ฮแตฃ(ฯยนยฒ)
   
   ๐ฬแตข = ((ฯยนยฒ *แตฃ โยฒSแตขยนยฒ) -แตฃ (Sแตขยนยฒ *แตฃ โยฒฯยนยฒ) +แตฃ (Sโฑผยนยฒ *แตฃ โยฒSโยนยฒ) +แตฃ (โSโฑผยนยฒ โแตฃ โSโยนยฒ) -แตฃ (Sโยนยฒ *แตฃ โยฒSโยนยฒ) -แตฃ (โSโยนยฒ โแตฃ โSโยนยฒ)) *แตฃ Pแตข
   ๐ฬโฑผ = ((ฯยนยฒ *แตฃ โยฒSโฑผยนยฒ) -แตฃ (Sโฑผยนยฒ *แตฃ โยฒฯยนยฒ) +แตฃ (Sโยนยฒ *แตฃ โยฒSแตขยนยฒ) +แตฃ (โSโยนยฒ โแตฃ โSแตขยนยฒ) -แตฃ (Sแตขยนยฒ *แตฃ โยฒSแตขยนยฒ) -แตฃ (โSแตขยนยฒ โแตฃ โSแตขยนยฒ)) *แตฃ Pโฑผ
   ๐ฬโ = ((ฯยนยฒ *แตฃ โยฒSโยนยฒ) -แตฃ (Sโยนยฒ *แตฃ โยฒฯยนยฒ) +แตฃ (Sแตขยนยฒ *แตฃ โยฒSโฑผยนยฒ) +แตฃ (โSแตขยนยฒ โแตฃ โSโฑผยนยฒ) -แตฃ (Sโฑผยนยฒ *แตฃ โยฒSโฑผยนยฒ) -แตฃ (โSโฑผยนยฒ โแตฃ โSโฑผยนยฒ)) *แตฃ Pโ

   return (๐ฬแตข, ๐ฬโฑผ, ๐ฬโ)
end

function compute_bivector_r(ฯยนยฒ, ๐ยนยฒ)
   ฯ, Sแตข, Sโฑผ, Sโ = map((dยนยฒ) -> dยนยฒ * dยนยฒ, (ฯยนยฒ, ๐ยนยฒ...))
   S = Sแตข + Sโฑผ + Sโ

   ๐ = map((Sโโฒ) -> inv_r((ฯ-S)/2.0 + Sโ), (Sแตข, Sโฑผ, Sโ))
   ๐ = compute_ฯ_r(ฯยนยฒ, ๐ยนยฒ, ๐)
   ๐ = compute_B_r(๐)
   ๐ฬ = compute_๐ฬ_r(ฯยนยฒ, ๐ยนยฒ, ๐)

   ฯแตขโบ, ฯแตขโป, ฯโฑผโบ, ฯโฑผโป, ฯโโบ, ฯโโป = ๐
   Bแตขแต, Bแตขสฒ, Bโฑผโฑ, Bโฑผแต, Bโสฒ, Bโโฑ = ๐
   ๐ฬแตข, ๐ฬโฑผ, ๐ฬโ = ๐ฬ

   vแตข = 0.25 *แตฃ (๐ฬแตข -แตฃ (Bแตขแต *แตฃ ๐ฬโฑผ) -แตฃ (Bแตขสฒ *แตฃ ๐ฬโ)) *แตฃ inv_r(1.0 -แตฃ (Bแตขแต *แตฃ ฯโฑผโบ) -แตฃ (Bแตขสฒ *แตฃ ฯโโป))
   vโฑผ = 0.25 *แตฃ (๐ฬโฑผ -แตฃ (Bโฑผโฑ *แตฃ ๐ฬโ) -แตฃ (Bโฑผแต *แตฃ ๐ฬแตข)) *แตฃ inv_r(1.0 -แตฃ (Bโฑผโฑ *แตฃ ฯโโบ) -แตฃ (Bโฑผแต *แตฃ ฯแตขโป))
   vโ = 0.25 *แตฃ (๐ฬโ -แตฃ (Bโสฒ *แตฃ ๐ฬแตข) -แตฃ (Bโโฑ *แตฃ ๐ฬโฑผ)) *แตฃ inv_r(1.0 -แตฃ (Bโสฒ *แตฃ ฯแตขโบ) -แตฃ (Bโโฑ *แตฃ ฯโฑผโป))
   
   return (vแตข, vโฑผ, vโ)
end